(self.legacyJsonp=self.legacyJsonp||[]).push([[56690],{154620:function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return a.apply(this,arguments)}function a(){var e;return e=regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return n=e.sent,e.next=5,n.blob();case 5:return r=e.sent,e.abrupt("return",new File([r],"image.png"));case 7:case"end":return e.stop()}},e)}),(a=function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,l,"next",e)}function l(e){r(o,i,a,s,l,"throw",e)}s(void 0)})}).apply(this,arguments)}n.d(t,{Z:function(){return i}})},569929:function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e,t){return a.apply(this,arguments)}function a(){var e;return e=regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e){var r=new FileReader;r.onload=function(){var i=new Image;i.src=r.result,i.onload=function(){var r=i.height,a=i.width;a>474&&(r*=474/a,a=474),n({src:i.src,height:r,width:a});var o=document.createElement("canvas");o.width=a,o.height=r,o.getContext("2d").drawImage(i,0,0,a,r),o.toBlob(function(n){e(new File([n],t.name,{type:"image/jpeg"}))},"image/jpeg",.9)}},r.readAsDataURL(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}),(a=function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,l,"next",e)}function l(e){r(o,i,a,s,l,"throw",e)}s(void 0)})}).apply(this,arguments)}n.d(t,{Z:function(){return i}})},364655:function(e,t,n){"use strict";n.d(t,{Z:function(){return L}});var r=n(258712),i=n(284987),a=n(132227),o=n(154620),s=n(56063),l=n(501106),u=n(582935),c=n(462995),h=n(233846),d=n(19035);function f(){var e=(0,h.ZP)(),t=(0,u.t)().setIsLensModalOpen;return(0,d.jsx)(a.xu,{dangerouslySetInlineStyle:{__style:{marginTop:260}},display:"flex",justifyContent:"center",children:(0,d.jsxs)(a.kC,{alignItems:"center",direction:"column",gap:8,children:[(0,d.jsx)(a.xu,{height:103,width:103,children:(0,d.jsx)(a.Ee,{alt:e._('Error state', 'Lens.history.error.illustration', 'Error illustration for filters drawer'),naturalHeight:1,naturalWidth:1,src:c})}),(0,d.jsx)(a.X6,{children:e._('No history', 'lens.history.empty.state', 'Header for the Lens history empty state')}),(0,d.jsx)(a.xv,{children:e._('You don\'t have any history items yet', 'lens.history.empty.state.description', 'Description for the Lens history empty state')}),(0,d.jsx)(a.zx,{onClick:function(){return t(!0)},size:"lg",text:e._('Upload an image to search', 'lens.search.button', 'Button to try lens search')})]})})}var _=n(231333),p=n(339908),g=n(143906),v=n(442563);function m(e){var t=e.onDelete,n=e.onSave,r=e.height,i=e.width,o=(0,h.ZP)(),s=(0,p.F9)(),l=function(){t(),s.showOneToast(function(e){var t=e.hideToast;return(0,d.jsx)(_.Z,{duration:g.A,onHide:t,text:(0,d.jsx)(a.xv,{children:o._('Successfully deleted', 'lens.history.image.deleted', 'Image from lens history has been deleted')})})})};return(0,d.jsxs)(a.xu,{dangerouslySetInlineStyle:{__style:{backgroundColor:"rgba(0,0,0,0.4)"}},height:r,left:!0,position:"absolute",rounding:4,top:!0,width:i,children:[(0,d.jsx)(a.xu,{margin:3,right:!0,top:!0,children:(0,d.jsx)(v.Z,{onClick:function(e){e.stopPropagation(),n()},pinKey:null})}),(0,d.jsx)(a.xu,{bottom:!0,margin:3,position:"absolute",right:!0,children:(0,d.jsx)(a.iP,{onTap:function(e){e.event.stopPropagation(),l()},rounding:"circle",children:(0,d.jsx)(a.xu,{alignItems:"center",color:"light",display:"flex",justifyContent:"center",minHeight:32,minWidth:32,padding:3,rounding:"circle",children:(0,d.jsx)(a.JO,{accessibilityLabel:o._('Delete', 'lens.history.image.delete', 'Clikcking on this delete the image from the lens history'),color:"default",icon:"trash-can",size:16})})})})]})}var y=n(569929),x=n(905921),w=n(19963),j=n(892671),P=n(316886),b=n(397657),A=n(113474),z=n(422378);function S(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function E(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){S(a,r,i,o,s,"next",e)}function s(e){S(a,r,i,o,s,"throw",e)}o(void 0)})}}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var L=function(){var e,t,n=(0,h.ZP)(),c=(0,i.k6)(),_=(0,w.v)().logContextEvent,p=(0,u.t)(),g=p.setHeroImageUrl,v=p.heroImageUrl,S=p.setImage,k=p.image,L=p.setImageData,R=I((0,r.useState)(),2),Z=R[0],D=R[1],C=I((0,r.useState)(!1),2),H=C[0],M=C[1],O=I((0,r.useState)(""),2),T=O[0],U=O[1],F=I((0,r.useState)(),2),W=F[0],J=F[1],N=(0,A.Z)({name:"ApiResource",options:{url:"/v3/visual_search/lens/history/",data:{fields:"id,image_urls,image_sizes"}}}),B=N.data,q=void 0===B?[]:B,K=N.fetchMore;(0,j.Q)({view_type:119,view_parameter:3064}),(0,r.useEffect)(function(){q&&D(q)},[q]);var Q=(e=E(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,b.Z)({url:"/v3/visual_search/lens/history/",data:{lens_history_ids:[t]},method:"DELETE"});case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}},e,null,[[0,5]])})),function(t){return e.apply(this,arguments)}),X=function(e){_({event_type:15657,view_parameter:4054,view_type:119,aux_data:{id:e}}),D(null==Z?void 0:Z.filter(function(t){return(null==t?void 0:t.id)!==e||(Q(e),!1)}))},Y=(0,r.useCallback)(E(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!W){e.next=6;break}return _({event_type:6707,view_parameter:4054,view_type:119,aux_data:{url:null!=v?v:""}}),e.next=4,(0,y.Z)(W,L);case 4:S(e.sent);case 6:case"end":return e.stop()}},e)})),[v,_,W,L,S]);(0,r.useEffect)(function(){(0,P.ZP)(k,W)||c.push("/lens-search/")},[k,W,c]),(0,r.useEffect)(function(){W&&Y()},[c,Y,W]);var $=(t=E(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return _({event_type:101,view_parameter:4054,view_type:119,aux_data:{url:t}}),e.next=3,(0,o.Z)(t);case 3:J(e.sent),g(t);case 6:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),G=function(e){_({event_type:101,element:48,view_parameter:4054,view_type:119,aux_data:{url:e}}),U(e),M(!0)};if(!Z)return null;var V=!!Z&&0===Z.length;return(0,d.jsxs)(r.Fragment,{children:[(0,d.jsx)(x.Z,{title:n._('History', 'lens.history.page.header', 'Heading for the Lens History Page')}),V?(0,d.jsx)(f,{}):(0,d.jsx)(a.xu,{dangerouslySetInlineStyle:{__style:{marginTop:x.M}},children:(0,d.jsx)(a.Rk,{columnWidth:s.yF,gutterWidth:24,items:Z,loadItems:K,renderItem:function(e){var t=e.data,r=t.id,i=function(e){for(var t=e.imageUrls,n=e.imageSizes,r=0,i=["736x","1200x","474x474","236x236"];r<i.length;r++){var a=i[r];if(t[a]&&n[a]){var o=Math.round(236/(n[a].width/n[a].height));return{url:t[a],height:o,width:s.yF}}}return null}({imageUrls:t.image_urls,imageSizes:t.image_sizes});if(i){var o=i.url,l=i.height,u=i.width;return(0,d.jsx)(z.q,{children:function(e){var t=e.hovered,i=e.onMouseEnter,s=e.onMouseLeave;return(0,d.jsxs)(a.xu,{onMouseEnter:i,onMouseLeave:s,position:"relative",children:[(0,d.jsx)(a.zd,{height:l,rounding:4,wash:!0,width:u,children:(0,d.jsx)(a.xu,{height:"100%",width:"100%",children:(0,d.jsx)(a.Ee,{alt:n._('Lens history image', 'lens.history.image.alt', 'Image that was uploaded by the user to Lens History'),fit:"cover",naturalHeight:1,naturalWidth:1,src:o})})}),t&&(0,d.jsx)(a.iP,{onTap:function(){return $(o)},children:(0,d.jsx)(m,{height:l,onDelete:function(){return X(r)},onSave:function(){return G(o)},width:u})})]})}},r)}return null},scrollContainer:function(){return window}})}),H&&(0,d.jsx)(l.Z,{imageUrl:T,onDismissModal:function(){return M(!1)}})]})}},772458:function(e,t,n){(window.__PWS_LOADED_HANDLERS__=window.__PWS_LOADED_HANDLERS__||[]).push(["www/lens-search/history",function(){return n(364655).Z}])},462995:function(e){"use strict";e.exports="https://s.pinimg.com/webapp/sad-puzzle-9071a8d0.svg"}},function(e){e.O(0,[97270,32227,76175,8789,75114,59514,10917,55965,92774,5966,62119,27684,32649,94457,9433,11611],function(){return e(e.s=772458)}),e.O()}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/www/lens-search/history-5837c7374c5fa564.js.map