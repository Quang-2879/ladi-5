"use strict";(self.legacyJsonp=self.legacyJsonp||[]).push([[509,23912],{298568:function(t,e,n){n.d(e,{E:function(){return i},S:function(){return o}});var r=(0,n(218291).Z)("pwtSurfaceContext"),o=r.Provider,i=r.useMaybeHook},482535:function(t,e,n){n.d(e,{F9:function(){return p},LM:function(){return s},VZ:function(){return a},cQ:function(){return v},rZ:function(){return l}});var r=n(719413),o=n(535768);function i(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return u(t,void 0);var n=({}).toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var a=function(){return"number"==typeof window.innerHeight&&"number"==typeof window.pageYOffset&&!!document.querySelector&&!!document.querySelectorAll},l=function(t){return t instanceof HTMLDivElement||t instanceof HTMLVideoElement?t.getBoundingClientRect():t.parentElement instanceof HTMLElement?t.parentElement.getBoundingClientRect():null},c=function(t,e){var n=t.top,r=t.height,o=e.foldY,i=n+e.pageYOffset;if(i>=o)return!1;var u=Math.min(r,o-i);return u>.5*r||u>.2*o},f=function(t){if(t instanceof HTMLImageElement)return t.src;if(t instanceof HTMLVideoElement)return t.attributes.poster.value;var e=((t.style||{}).backgroundImage||"").match(/^url\(["'](.*)["']\)$/);return e&&e[1]||null},s=function(){return document.querySelector?document.querySelectorAll(r.wc).length:((0,o.H)("missing_document_query_selector"),0)},m=function(){if(!document.querySelector)return(0,o.H)("missing_document_query_selector"),null;var t=document.querySelectorAll(r.wc);return t[t.length-1]||null},d=function(t,e){var n=l(t);if(!n)return(0,o.H)("missing_client_rect"),!1;if(n.width<70&&n.height<70){if(t instanceof HTMLImageElement)return!1;var r=f(t);if(null!=r&&r.endsWith("svg"))return!1}return c(n,e)},p=function(){var t=m();if(!t)return!1;var e=window.innerHeight||0,n=window.pageYOffset||0;return t.getBoundingClientRect().top+n>=e},v=function(t,e,n){if(!document.querySelector)return(0,o.H)("missing_document_query_selector"),[];var u={foldY:window.innerHeight||0,pageYOffset:window.pageYOffset||0},a=[r.Wf].concat(i(t?[r.fF]:[]),i(e?[r.$N]:[])).join(","),l=i(document.querySelectorAll(a));if(n){var c=i(document.querySelectorAll('div[data-test-id="board-section"]')),s=function t(e){var n=i(e.children);!n.length&&e.style.backgroundImage?l.push(e):n.length&&n.forEach(function(e){t(e)})};c.forEach(function(t){s(t)})}return l.reduce(function(t,n){if((n instanceof HTMLImageElement||n instanceof HTMLDivElement||n instanceof HTMLVideoElement&&e)&&d(n,u)){var r=f(n);if(r){var o=(r||"").replace(/.*\//,"");return t.concat([{element:n,fileName:o}])}}return t},[])}},719413:function(t,e,n){n.d(e,{$N:function(){return l},Kb:function(){return r},Wf:function(){return u},fF:function(){return a},wc:function(){return i}});var r="pwt-grid-item",o=['div[data-grid-item="true"]',"div.Grid__Item",'div[data-test-id="'.concat(r,'"]')],i=o.join(","),u=o.map(function(t){return"".concat(t," img")}).join(","),a=o.map(function(t){return"".concat(t," div[style*=background-image]")}).join(","),l=o.map(function(t){return"".concat(t," video")}).join(",")},300509:function(t,e,n){n.d(e,{Z:function(){return S},v:function(){return _}});var r=n(258712),o=n(967312),i=n(582082),u=n(150739),a=n(482535),l=n(535768),c=n(17433),f=n(298568),s=n(331118),m=n(116657),d=n(481714),p=n(992114);function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach(function(e){var r,o,i;r=t,o=e,i=n[e],(o=function(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=v(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==v(e)?e:e+""}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],l=!0,c=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(t){c=!0,o=t}finally{try{if(!l&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var n=({}).toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var w=(0,u.XV)("GridProfiler"),_=function(){return!!window.addEventListener&&!!window.removeEventListener&&(0,a.VZ)()},E=function(t,e){if(!e){var n=(0,a.LM)();if(n===t)return w("No new items, so skip the viewport-fill check."),{complete:!1,numOfItemsChecked:t};if(!(0,a.F9)())return w("Viewport may not be filled yet."),{complete:!1,numOfItemsChecked:n}}return{complete:!0}},C=function(t,e){var n=0,r=0,o=0,i=0,u=0;return t=t.filter(function(t){return"pin"===t.type}),e.forEach(function(e,a){var l,c,f,s,m,d,p,v=e.fileName.split(".")[0];v!==(null==(l=p=t[a])?void 0:l.image_signature)&&(p=t.find(function(t){return v===(null==t?void 0:t.image_signature)})),void 0===p?u+=1:p.is_promoted||(null==(c=p.recommendation_reason)?void 0:c.reason)==="PROMOTED_PIN"||null!=(f=p)&&null!=(s=f.promoter)&&s.length?o+=1:null!==p.story_pin_data_id&&void 0!==p.story_pin_data_id?n+=1:null!=(m=p)&&null!=(d=m.videos)&&d.video_list?r+=1:i+=1}),{storyPinCount:n,videoCount:r,adCount:o,imageCount:i,unknownCount:u}},O=function(t,e){var n=function n(){window.removeEventListener(t,n),e()};return window.addEventListener(t,n),function(){return window.removeEventListener(t,n)}};function S(t){var e=t.isAtEndOfFeed,n=t.pinData,v=t.includeBackgroundImages,g=t.includeVideos,b=void 0!==g&&g,_=t.includeSections,S=t.isPlaceholderGrid,I=t.stopwatchSetVisuallyCompleteResult,A=t.stopwatchContext,T=t.isAuth,L=(0,f.E)(),j=(null==L?void 0:L.getId())||(0,m.P9)(),M=null==L?void 0:L.setVisuallyCompleteResult,k=function(t){var e=t.imageTimings;I&&I(),M&&M({imageTimings:e}),(0,m.cB)(e)},P=h((0,r.useState)({status:"DISABLED"}),2),H=P[0],D=P[1],q=(0,o.F)();(0,r.useEffect)(function(){D({status:"LAYOUT",failedCount:0,numOfItemsChecked:0})},[j]),(0,r.useEffect)(function(){if(w("new status",H),"LAYOUT"===H.status){var t=O("scroll",function(){(0,c.ZP)("scrollDuringLayout")});return function(){t()}}return function(){}},[H.status]),(0,d.Z)(function(){var t="unknown",r="unknown",o=function(){},c=function(t){L?L.abort(t):null==A||A.abort()};if(L){var f=(0,L.getMetricId)();r=f.surface,t=(0,i.KJ)(f),o=L.addBinaryAnnotation}else r="stopwatch",t="".concat(r,"_").concat(null==A?void 0:A.name),null!=A&&A.addBinaryAnnotation&&(o=null==A?void 0:A.addBinaryAnnotation);var d=(0,a.cQ)(v,b,_);if(S)return void w("bypassing PWT run due to skeleton pin grid");switch(H.status){case"LAYOUT":var g=E(H.numOfItemsChecked,e);g.complete?D({status:"TIMING",failedCount:0,pinElements:d}):500*H.failedCount>6e4?((0,l.A9)("images.".concat(t,".visuallyComplete.maxLayoutAttempt")),c("visuallyComplete_layoutTimeout"),(0,m.JG)("visuallyComplete_layoutTimeout"),D({status:"DISABLED"})):D(y(y({},H),{},{failedCount:H.failedCount+1,numOfItemsChecked:g.numOfItemsChecked}));break;case"TIMING":var O=(0,s.Cg)(),I=H.pinElements.length,j=[],M=0,P=0,Y=0,B=1/0,N=0;if(H.pinElements.forEach(function(t){var e=t.element,n=t.fileName,o=O.find(function(t){return t.name.endsWith(n)});o?o.responseEnd?(j.push(o),(0,u.v5)(e,"green"),"search"===r&&(B=Math.min(B,o.requestStart),N=Math.max(N,o.responseEnd))):(Y+=1,(0,u.v5)(e,"blue")):e instanceof HTMLImageElement&&e.complete?(P+=1,(0,u.v5)(e,"red")):(M+=1,(0,u.v5)(e,"greenyellow"))}),M||Y)100*H.failedCount>6e4?((0,l.A9)("images.".concat(t,".visuallyComplete.maxAttempt"),{tags:{totalImageCount:I,incompleteCount:M,noTimingCount:P,noTimingResponseEndCount:Y}}),c("visuallyComplete_timingTimeout"),(0,m.JG)("visuallyComplete_timingTimeout"),D({status:"DISABLED"})):D(y(y({},H),{},{failedCount:H.failedCount+1}));else{if(w("All ".concat(j.length," images are fetched")),n&&n.length){var R=C(n,H.pinElements);if(Object.entries(R).forEach(function(t){var e=h(t,2),n=e[0],r=e[1];o(n,r,"I16"),(0,m.XJ)(n,r,"I16")}),(0,l.A9)("".concat(t,".pinTypes"),{tags:R}),"search"===r){var V,G=N-B;(null==(V=n[0].display_options)?void 0:V.num_columns_requested)===0?(0,p.LY)("full_width_story_image_fetch_time_true",G,{sampleRate:1}):(0,p.LY)("full_width_story_image_fetch_time_false",G,{sampleRate:.05})}}if(T&&"search"===r){var Z=q.checkExperiment("dweb_grid_loading_state").group;Z&&(0,p.S0)("webapp.gridVisuallyComplete.loadingState",I,{sampleRate:1,tags:{group:Z}})}k({imageTimings:j}),D({status:"DISABLED"}),(0,l.A9)("images.".concat(t,".visuallyComplete.complete"),{tags:{totalImageCount:I,noTimingCount:P}})}}},"LAYOUT"===H.status&&500||"TIMING"===H.status&&100||null)}},481714:function(t,e,n){var r=n(258712);e.Z=function(t,e){var n=(0,r.useRef)(function(){});(0,r.useEffect)(function(){n.current=t},[t]),(0,r.useEffect)(function(){if(null===e)return function(){};var t=setInterval(function(){return n.current()},e);return function(){return clearInterval(t)}},[e])}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/509-8621863f5d5d50f2.js.map